{{ define "title" }}帳號管理{{ end }}
{{ define "content-with-session" }}
<script src="/static/js/delete.js"></script>
<script src="/static/js/update.js"></script>
<h1>帳號管理</h1>

<form action="/accounts" method="get">
{{ if gt .Data.Page 1 }}
<a href="/accounts?page={{ add .Data.Page -1 }}">上一頁</a>
{{ end }}
<span>第<input id="page" type="number" name="page" value="{{ .Data.Page }}">頁</span>
{{ if eq 100 (len .Data.Accounts) }}
<a href="/accounts?page={{ add .Data.Page 1}}">下一頁</a>
{{ end }}
<br>
{{ $acct := .Account }}

{{ if eq $acct.Authority.Account 3 }}
<a href="/register">新增使用者</a>
<a href="/import">匯入帳號資料 (.csv 檔)</a>
{{ end }}
</form>
<table>
    <tr>
        <th>帳號</th>
        <th>班級</th>
        <th>座號</th>
        <th>姓名</th>
        <th>身份</th>
        <th>體溫管理權限</th>
        <th>帳號管理權限</th>
        {{ if eq $acct.Authority.Account 3 }}
        <th></th>
        <th></th>
        {{ end }}
    </tr>
    <tbody>
        {{ range .Data.Accounts }}
        <tr {{ if eq .Role 1 }} class="admin" {{ end }} {{ if eq .Role 2 }} class="staff" {{ end }}
            {{ if and ( eq .Authority.Record 2 ) ( eq .Role 3 ) }} class="hygiene" {{ end }}>
            <td>{{ .ID }}</td>
            <td>{{ .Class }}</td>
            <td>{{ .Number }}</td>
            <td>{{ .Name }}</td>
            {{ if and ( eq $acct.Authority.Account 3 ) ( ne .ID "admin" ) }}
            <td>
                <select name="role" onchange="update('{{ .ID }}', this.name, this.value)">
                    <option value="admin" {{ if eq .Role 1 }}selected{{ end }}>管理員</option>
                    <option value="staff" {{ if eq .Role 2 }}selected{{ end }}>教職員</option>
                    <option value="student" {{ if eq .Role 3 }}selected{{ end }}>學生</option>
                </select>
            </td>
            {{ else }}
            <td>{{ .Authority }}</td>
            {{ end }}
            {{ if and ( ge $acct.Authority.Account 2 ) ( ne .ID "admin" ) }}
            <td>
                <select name="record_authority" onchange="update('{{ .ID }}', this.name, this.value)">
                    <option value="self" {{ if eq .Authority.Record 1 }}selected{{ end }}>個人</option>
                    <option value="group" {{ if eq .Authority.Record 2 }}selected{{ end }}>班級</option>
                    <option value="all" {{ if eq .Authority.Record 3 }}selected{{ end }}>全校</option>
                </select>
            </td>
            <td>
                <select name="account_authority" onchange="update('{{ .ID }}', this.name, this.value)">
                    <option value="self" {{ if eq .Authority.Account 1 }}selected{{ end }}>個人</option>
                    <option value="group" {{ if eq .Authority.Account 2 }}selected{{ end }}>班級</option>
                    <option value="all" {{ if eq .Authority.Account 3 }}selected{{ end }}>全校</option>
                </select>
            </td>
            {{ else }}
            <td>{{ .Authority.Record }}</td>
            <td>{{ .Authority.Account }}</td>
            {{ end }}
            {{ if or (eq $acct.Authority.Account 3) (eq $acct.Authority.Account 2) }}
            <td>
                <button><a href="/reset?account_id={{ .ID }}">重設密碼</a></button>
            </td>
            <td>
                {{ if ne .ID "admin" }}
                <button value="{{ .ID }}" onclick="deleteAccount(this)">刪除帳號</button>
                {{ end }}
            </td>
            {{ end }}
        </tr>
        {{ end }}
    </tbody>
</table>
{{ if gt .Data.Page 1 }}
<a href="/accounts?page={{ add .Data.Page -1 }}">上一頁</a>
{{ end }}
<span>第<input id="page" type="number" name="page" value="{{ .Data.Page }}">頁</span>
{{ if eq 100 (len .Data.Accounts) }}
<a href="/accounts?page={{ add .Data.Page 1}}">下一頁</a>
{{ end }}

{{ end }}